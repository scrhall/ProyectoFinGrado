<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.activiti.org/test">
  <process id="Reuniones" name="Reuniones" isExecutable="true">
    <exclusiveGateway id="exclusivegateway1" name="¿Es Reunion 2 o 4? " default="flow3"></exclusiveGateway>
    <exclusiveGateway id="exclusivegateway2" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow3" name="Si" sourceRef="exclusivegateway1" targetRef="exclusivegateway2">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [RGETMail]
			def emailAction="DONE"; 
			def subject = "Nueva reunión de seguimiento del proyecto: "+ProjectName;
			def body = """\
			Hola, a continuación se adjunta un link desde el que puede rellenar la orden del día de la reunión, además debe exponer las posibles fechas en las 
			que realizar la reunión siguiendo el siguiente formato:
			<br/>
			<--<br/>
			Fechas:Fecha posible 1,Fecha posible 2,Fecha posible 3...<br/>
			
			--><br/>
			<br/>
			El link con la dirección de la orden del día es el siguiente:<br/>	<a href="""+URLOrdenDia+""">Orden del Dia</a>
			<br/>
			<br/>
			Muchas gracias por su tiempo."""
			execution.setVariable("tos",tos)
			execution.setVariable("emailAction",emailAction)
			execution.setVariable("subject", subject)
			execution.setVariable("body", body)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <exclusiveGateway id="exclusivegateway3" name="¿Es la Reunion 1?"></exclusiveGateway>
    <sequenceFlow id="flow4" name="No" sourceRef="exclusivegateway1" targetRef="exclusivegateway3">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${Reunion==1||Reunion==3}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow5" name="Si" sourceRef="exclusivegateway3" targetRef="manualtask2">
      <extensionElements>
        <activiti:executionListener event="taken" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def Doc = "DAFO.docx";           
            execution.setVariable("Doc",Doc);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${Reunion==1}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow6" name="No" sourceRef="exclusivegateway3" targetRef="manualtask1">
      <extensionElements>
        <activiti:executionListener event="taken" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def TemplateDirectory = "/Plantillas/Reuniones";
            def Doc = "OrdenDia.docx";
            execution.setVariable("TemplateDirectory",TemplateDirectory);            
            execution.setVariable("Doc",Doc);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.CreateDirectory"></activiti:executionListener>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.CopyDocumentTemplate"></activiti:executionListener>
      </extensionElements>
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${Reunion==3}]]></conditionExpression>
    </sequenceFlow>
    <exclusiveGateway id="exclusivegateway4" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow7" sourceRef="manualtask1" targetRef="exclusivegateway4">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [RGETMail]
			def emailAction="DONE"; 
			def subject = "Nueva reunión de seguimiento del proyecto: "+ProjectName;
			def body = """\
			Hola, a continuación se adjunta un link desde el que puede rellenar la orden del día de la reunión. <br/><br/>
			Para facilitar el seguimiento de la misma se adjunta el analisis DAFO realizado en la primera reunión del año<br/>:<a href="""
			+URLDAFOReunion1+""">DAFO</a><br/><br/>
			Una vez rellenada la orden del día debe contestar al correo con las posibles fechas en las 
			que realizar la reunión siguiendo el siguiente formato:
			<br/>
			<--<br/>
			Fechas:Fecha posible 1,Fecha posible 2,Fecha posible 3...<br/>			
			--><br/>
			<br/>
			El link con la dirección de la orden del día es el siguiente:<br/>	<a href="""+URLOrdenDia+""">Orden del Día</a>
			<br/>
			<br/>
			Muchas gracias por su tiempo."""
			execution.setVariable("tos",tos)
			execution.setVariable("emailAction",emailAction)
			execution.setVariable("subject", subject)
			execution.setVariable("body", body)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <sequenceFlow id="flow8" sourceRef="manualtask2" targetRef="exclusivegateway4">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [RGETMail]
			def emailAction="DONE"; 
			def subject = "Nueva reunión de seguimiento del proyecto: "+ProjectName;
			def body = """\
			Hola, a continuación se adjunta un link desde el que puede rellenar la orden del dia de la reunion. <br/><br/>
			Al tratarse de la primera reunión del proyecto debe rellenar un analisis DAFO del mismo que se encuentra en la siguiente
			dirección: <br/><a href="""+URLDAFO+""">DAFO</a><br/>
			Una vez rellenada la orden del dia debe responder al correo con las posibles fechas en las 
			que realizar la reunión siguiendo el siguiente formato:
			<br/>
			<--<br/>
			Fechas:Fecha posible 1,Fecha posible 2,Fecha posible 3...<br/>			
			--><br/>
			<br/>
			El link con la dirección de la orden del dia es el siguiente:<br/>	<a href="""+URLOrdenDia+""">Orden del Día</a>
			<br/>
			<br/>
			Muchas gracias por su tiempo."""
			execution.setVariable("tos",tos)
			execution.setVariable("emailAction",emailAction)
			execution.setVariable("subject", subject)
			execution.setVariable("body", body)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <sequenceFlow id="flow9" sourceRef="exclusivegateway4" targetRef="exclusivegateway2"></sequenceFlow>
    <userTask id="usertask5" name="Elegir fecha y modificar orden del dia" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow12" sourceRef="exclusivegateway5" targetRef="usertask6"></sequenceFlow>
    <userTask id="usertask6" name="Evaluar fecha y orden del dia" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow15" sourceRef="exclusivegateway6" targetRef="usertask8"></sequenceFlow>
    <userTask id="usertask8" name="Registrar confirmaciones" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow16" sourceRef="usertask8" targetRef="usertask9">
      <extensionElements>
        <activiti:executionListener event="taken" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def src = ProjectPath+"/OrdenDia.docx";
            def dest = ProjectPath;
            def Doc = "Acta";
            execution.setVariable("src",src);
            execution.setVariable("dest",dest);            
            execution.setVariable("Doc",Doc);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
        <activiti:executionListener event="take" class="isaFoundry.processEngine.CopyDocument"></activiti:executionListener>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [RGETMail]
			def emailAction="DONE"; 
			def subject = "Acta reunión de seguimiento del proyecto: "+ProjectName;
			def body = """\
			Hola, a continuación se adjunta un link desde el que puede rellenar el acta de la reunión. Es una copia de la orden del dia anteriormente redactada.<br/> <br/>
			Una vez rellenada el acta simplemente tiene que contestar al correo indicando el correo de los revisores del acta (asistentes a 
			la reunión) siguiendo el formato: <br/>
			<br/>
			<--<br/>
			Asistentes:Correo asistente 1,Correo asistente 2,...<br/>			
			--><br/>
			<br/>
			El link con la dirección del acta es el siguiente:<br/>	<a href="""+URLActa+""">Acta</a>
			<br/>
			<br/>
			Muchas gracias por su tiempo."""
			execution.setVariable("tos",tos)
			execution.setVariable("emailAction",emailAction)
			execution.setVariable("subject", subject)
			execution.setVariable("body", body)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <userTask id="usertask9" name="Levantar acta" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow18" sourceRef="usertask9" targetRef="usertask10">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = Asistentes
			def emailAction="MULTI"; 
			def subject = "Revise el acta de la reunión de seguimiento del proyecto: "+ProjectName;
			def body = """\
			Hola, a continuación se adjunta un link desde el que sugerir algunas modificaciones del acta de la reunion. <br/>
			Por favor se le ruega haga comente las partes que quiera modificar para que el RGET proceda a su modificación en caso de 
			que sea oportuno.<br/><br/>
			Una vez haya realizado todas las modificaciones oportunas responda al correo, no es necesario añadir texto.
			<br/>
			El link con la dirección del acta de es el siguiente:<br/>	<a href="""+URLActa+""">Acta</a>
			<br/>
			<br/>
			Muchas gracias por su tiempo."""
			execution.setVariable("tos",tos)
			execution.setVariable("tosResponse",[])
			execution.setVariable("emailAction",emailAction)
			execution.setVariable("subject", subject)
			execution.setVariable("body", body)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <userTask id="usertask10" name="Proponer modificaciones de acta" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow19" sourceRef="exclusivegateway7" targetRef="usertask11">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [RGETMail]
			def emailAction="DONE"; 
			def subject = "Modificaciones del acta de la reunión de seguimiento del proyecto: "+ProjectName;
			def body = """\
			Hola, a continuación se adjunta un link desde el que puede ver las sugerencias, de los asistentes a la reunión, sobre el acta redactada de la misma.<br/>
			<br/>Una vez haya realizado todas las modificaciones oportunas responda al correo, no es necesario añadir texto.
			<br/>
			El link con la dirección del acta de es el siguiente:<br/>	<a href="""+URLActa+""">Acta</a>
			<br/>
			<br/>
			Muchas gracias por su tiempo."""
			execution.setVariable("tos",tos)
			execution.setVariable("emailAction",emailAction)
			execution.setVariable("subject", subject)
			execution.setVariable("body", body)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <userTask id="usertask11" name="Modificar acta" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <endEvent id="endevent1" name="End"></endEvent>
    <boundaryEvent id="boundarytimer1" name="Timer" attachedToRef="usertask5" cancelActivity="true">
      <timerEventDefinition>
        <timeDuration>P7D</timeDuration>
      </timerEventDefinition>
    </boundaryEvent>
    <exclusiveGateway id="exclusivegateway5" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow21" sourceRef="usertask5" targetRef="exclusivegateway5">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[puntuaciones=[]
			personas=[]
			for (i in 0..Fechas.size()){
				puntuaciones[i]=0
				personas[i]=""
			}
			for (respuestas in tosResponse){
				for (idfecha in respuestas['Fechas']){
					idfecha=idfecha.toInteger()				
					puntuaciones.putAt(idfecha, puntuaciones.get(idfecha)+1)				
					personas.putAt(idfecha, personas[idfecha]+","+respuestas.get("From"))
				}
			}
			estadistica=""
			for (i in 0..Fechas.size()-1){
				estadistica=estadistica+"Fecha: "+Fechas[i]+"==>"+puntuaciones[i]+" Personas que han respondido si: "+personas[i]+"<br/>"
            }
            def tos = [RGETMail]
			def emailAction="DONE"; 
			def subject = "Evalue fecha y orden del dia de la reunión del proyecto: "+ProjectName;
			def body = """\
			Hola, a continuación se muestra los resultados la votación para la selección de fecha de celebración
			de la reunion.<br/> <br/>"""+estadistica+"""<br/><br/>Todos los miembros del equipo han contestado.<br/>
			Además se adjunta una url donde se encuentra la orden del día ya modificada por los miembros del equipo.<br/>
			El link con la dirección de la orden del día es el siguiente:<br/>	<a href="""+URLOrdenDia+""">Orden del Día</a>
			<br/><br/>
			Una vez modificada la orden del día, en caso de que sea necesario, debe responder al correo con la fecha final de 
			celebración de la reunión usando el siguiente formato:
			<br/>
			<--<br/>
			FechaFinal:*Fecha de celebracion*<br/>			
			--><br/>
			<br/>			
			<br/>
			Muchas gracias por su tiempo."""
			execution.setVariable("Estadistica",estadistica)
			execution.setVariable("tos",tos)
			execution.setVariable("emailAction",emailAction)
			execution.setVariable("subject", subject)
			execution.setVariable("body", body)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <exclusiveGateway id="exclusivegateway6" name="Exclusive Gateway"></exclusiveGateway>
    <boundaryEvent id="boundarytimer3" name="Timer" attachedToRef="usertask10" cancelActivity="true">
      <timerEventDefinition>
        <timeDuration>P7D</timeDuration>
      </timerEventDefinition>
    </boundaryEvent>
    <exclusiveGateway id="exclusivegateway7" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow25" sourceRef="usertask10" targetRef="exclusivegateway7"></sequenceFlow>
    <userTask id="usertask13" name="Confirmar asistencia" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow23" sourceRef="usertask13" targetRef="exclusivegateway6">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[SiAsiste=[]
			NoAsiste=[]
			Contestan=[]
			
			for (respuestas in tosResponse){
				if(respuestas['Asistencia']=="Si"){
					SiAsiste.add(respuestas.get("From"))
				}else{
					NoAsiste.add(respuestas.get("From"))
				}
				Contestan.add(respuestas.get("From"))			
			}
			NC=UGIDIET-Contestan
			
			def tos = [RGETMail]
			def emailAction="DONE"; 
			def subject = "Confirmación de asistencia de la reunión de seguimiento del proyecto: "+ProjectName;
			def body = """\
			Hola, a continuación se muestran los resultados de la confirmación de asistencia a la reunión propuesta el : 
			"""+FechaFinal+"""<br/><br/>Miembros que han contestado SI: """+SiAsiste+"""<br/>Miembros que han contestado NO: """+NoAsiste+"""<br/>
			Miembros que no han contestado: """+NC+"""<br/><br/>
			Responda al correo para marcar la actividad como finalizada, no es necesario enviar texto alguno.
			<br/>
			<br/>
			Muchas gracias por su tiempo."""
			execution.setVariable("tos",tos)
			execution.setVariable("emailAction",emailAction)
			execution.setVariable("subject", subject)
			execution.setVariable("body", body)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <boundaryEvent id="boundarytimer4" name="Timer" attachedToRef="usertask13" cancelActivity="true">
      <timerEventDefinition>
        <timeDuration>P7D</timeDuration>
      </timerEventDefinition>
    </boundaryEvent>
    <sequenceFlow id="flow35" sourceRef="usertask11" targetRef="endevent1"></sequenceFlow>
    <startEvent id="startevent1" name="Start">
      <extensionElements>
        <activiti:executionListener event="start" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def TemplateDirectory = "/Plantillas/Reuniones";
            def Doc = "OrdenDia.docx";
            execution.setVariable("TemplateDirectory",TemplateDirectory);            
            execution.setVariable("Doc",Doc);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.CreateDirectory"></activiti:executionListener>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.CopyDocumentTemplate"></activiti:executionListener>
      </extensionElements>
    </startEvent>
    <task id="manualtask1" name="Incluir DAFO Reunion1"></task>
    <task id="manualtask2" name="Incluir plantilla DAFO">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.CopyDocumentTemplate"></activiti:executionListener>
      </extensionElements>
    </task>
    <sequenceFlow id="flow37" sourceRef="usertask6" targetRef="usertask13">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = UGIDIET
			def emailAction="MULTI"; 
			def subject = "Fecha de celebración de reunión de seguimiento del proyecto: "+ProjectName;
			def body = """\
			Hola, a continuación se adjunta un link desde el que puede ver la orden del día de la reunión. <br/><br/>
			La fecha de celebracion de la reunion será: """+FechaFinal+"""<br/><br/>
			Por favor confirme si asistirá o no a la reunión respondiendo al correo con el siguiente formato:
			<br/>
			<--<br/>
			Asistencia:Si/No<br/>
			--><br/>
			<br/>
			El link con la dirección de la orden del día es el siguiente:<br/>	<a href="""+URLOrdenDia+""">Orden del Día</a>
			<br/>
			<br/>
			Muchas gracias por su tiempo."""
			execution.setVariable("tos",tos)
			execution.setVariable("tosResponse",[])
			execution.setVariable("emailAction",emailAction)
			execution.setVariable("subject", subject)
			execution.setVariable("body", body)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <sequenceFlow id="flow38" sourceRef="startevent1" targetRef="exclusivegateway1"></sequenceFlow>
    <userTask id="usertask14" name="Proponer fecha y orden del dia" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow39" sourceRef="exclusivegateway2" targetRef="usertask14"></sequenceFlow>
    <sequenceFlow id="flow40" sourceRef="usertask14" targetRef="usertask5">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[muestraFechas=""
            for (i in 0..Fechas.size()-1){
            		muestraFechas=muestraFechas+Integer.toString(i)+") "+Fechas[i]+"<br/>"
            }
            def tos = UGIDIET
			def emailAction="MULTI"; 
			def subject = "Nueva reunión de seguimiento del proyecto: "+ProjectName;
			def body = """\
			Hola, a continuación se adjunta un link desde el que puede modificar la orden del dia de la reunión. <br/>
			<br/>Además las fechas posbiles propuestas por el RGET para la celebracion de la reunión son:<br/>"""+muestraFechas+"""<br/><br/>
			Una vez modificada la orden del dia, en caso de que sea necesario, debe responder al correo con las posibles fechas en las 
			que tiene disponibilidad para realizar la reunión indicando el número de la fecha con el siguiente formato:
			<br/>
			<--<br/>
			Fechas:1,3,4<br/>			
			--><br/>
			<br/>
			El link con la dirección de la orden del día es el siguiente:<br/>	<a href="""+URLOrdenDia+""">Orden del Día</a>
			<br/>
			<br/>
			Muchas gracias por su tiempo."""
			execution.setVariable("tos",tos)
			execution.setVariable("emailAction",emailAction)
			execution.setVariable("subject", subject)
			execution.setVariable("body", body)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <sequenceFlow id="flow41" sourceRef="boundarytimer1" targetRef="exclusivegateway5">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def emailAction="DONE"; 
			def subject = "Evalue fecha y orden del día de la reunión del proyecto: "+ProjectName;
			def body = """\
			Hola, a continuación se muestra los resultados la votacion para la selección de fecha de celebración
			de la reunion. <br/><br/>"""+Fechas+"""<br/><br/>Los miembros del equipo que no han contestado son:<br/>"""+tos+"""<br/>
			<br/>Además se adjunta una url donde se encuentra la orden del día ya modificada por los miembros del equipo.<br/>
			El link con la dirección de la orden del día es el siguiente:<br/>	<a href="""+URLOrdenDia+""">Orden del Día</a>
			<br/>
			Una vez modificada la orden del día, en caso de que sea necesario, debe responder al correo con la fecha final de 
			celebración de la reunión usando el siguiente formato:
			<br/>
			<--<br/>
			FechaFinal:*Fecha de celebración*<br/>			
			--><br/>
			<br/>			
			<br/>
			Muchas gracias por su tiempo."""
			def tos = [RGETMail]
			execution.setVariable("tos",tos)
			execution.setVariable("emailAction",emailAction)
			execution.setVariable("subject", subject)
			execution.setVariable("body", body)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <sequenceFlow id="flow42" sourceRef="boundarytimer4" targetRef="exclusivegateway6"></sequenceFlow>
    <sequenceFlow id="flow43" sourceRef="boundarytimer3" targetRef="exclusivegateway7"></sequenceFlow>
    <textAnnotation id="textannotation4">
      <text>Por cada uno de los miembros</text>
    </textAnnotation>
    <association id="association4" sourceRef="usertask5" targetRef="textannotation4"></association>
    <textAnnotation id="textannotation5">
      <text>Por cada uno de los miembros</text>
    </textAnnotation>
    <association id="association5" sourceRef="usertask13" targetRef="textannotation5"></association>
    <textAnnotation id="textannotation6">
      <text>Por cada uno de los miembros</text>
    </textAnnotation>
    <association id="association6" sourceRef="usertask10" targetRef="textannotation6"></association>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_Reuniones">
    <bpmndi:BPMNPlane bpmnElement="Reuniones" id="BPMNPlane_Reuniones">
      <bpmndi:BPMNShape bpmnElement="exclusivegateway1" id="BPMNShape_exclusivegateway1">
        <omgdc:Bounds height="40.0" width="40.0" x="250.0" y="237.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway2" id="BPMNShape_exclusivegateway2">
        <omgdc:Bounds height="40.0" width="40.0" x="550.0" y="237.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway3" id="BPMNShape_exclusivegateway3">
        <omgdc:Bounds height="40.0" width="40.0" x="310.0" y="350.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway4" id="BPMNShape_exclusivegateway4">
        <omgdc:Bounds height="40.0" width="40.0" x="500.0" y="350.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask5" id="BPMNShape_usertask5">
        <omgdc:Bounds height="70.0" width="105.0" x="880.0" y="568.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="boundarytimer1" id="BPMNShape_boundarytimer1">
        <omgdc:Bounds height="30.0" width="30.0" x="960.0" y="620.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask6" id="BPMNShape_usertask6">
        <omgdc:Bounds height="60.0" width="105.0" x="1110.0" y="234.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask8" id="BPMNShape_usertask8">
        <omgdc:Bounds height="60.0" width="105.0" x="1450.0" y="228.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask9" id="BPMNShape_usertask9">
        <omgdc:Bounds height="55.0" width="105.0" x="1710.0" y="230.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask10" id="BPMNShape_usertask10">
        <omgdc:Bounds height="85.0" width="105.0" x="1810.0" y="560.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask11" id="BPMNShape_usertask11">
        <omgdc:Bounds height="55.0" width="105.0" x="2000.0" y="230.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent1" id="BPMNShape_endevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="2170.0" y="240.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway5" id="BPMNShape_exclusivegateway5">
        <omgdc:Bounds height="40.0" width="40.0" x="1020.0" y="582.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway6" id="BPMNShape_exclusivegateway6">
        <omgdc:Bounds height="40.0" width="40.0" x="1440.0" y="582.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="boundarytimer3" id="BPMNShape_boundarytimer3">
        <omgdc:Bounds height="30.0" width="30.0" x="1890.0" y="637.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway7" id="BPMNShape_exclusivegateway7">
        <omgdc:Bounds height="40.0" width="40.0" x="1980.0" y="582.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask13" id="BPMNShape_usertask13">
        <omgdc:Bounds height="55.0" width="105.0" x="1280.0" y="575.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="boundarytimer4" id="BPMNShape_boundarytimer4">
        <omgdc:Bounds height="30.0" width="30.0" x="1360.0" y="620.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="startevent1" id="BPMNShape_startevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="160.0" y="240.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="manualtask1" id="BPMNShape_manualtask1">
        <omgdc:Bounds height="65.0" width="105.0" x="370.0" y="379.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="manualtask2" id="BPMNShape_manualtask2">
        <omgdc:Bounds height="55.0" width="105.0" x="370.0" y="296.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask14" id="BPMNShape_usertask14">
        <omgdc:Bounds height="64.0" width="105.0" x="640.0" y="226.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="textannotation4" id="BPMNShape_textannotation4">
        <omgdc:Bounds height="50.0" width="100.0" x="940.0" y="490.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="textannotation5" id="BPMNShape_textannotation5">
        <omgdc:Bounds height="50.0" width="100.0" x="1360.0" y="500.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="textannotation6" id="BPMNShape_textannotation6">
        <omgdc:Bounds height="50.0" width="100.0" x="1914.0" y="500.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="flow3" id="BPMNEdge_flow3">
        <omgdi:waypoint x="290.0" y="257.0"></omgdi:waypoint>
        <omgdi:waypoint x="550.0" y="257.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="13.0" width="9.0" x="10.0" y="0.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow4" id="BPMNEdge_flow4">
        <omgdi:waypoint x="270.0" y="277.0"></omgdi:waypoint>
        <omgdi:waypoint x="270.0" y="370.0"></omgdi:waypoint>
        <omgdi:waypoint x="310.0" y="370.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="13.0" width="14.0" x="10.0" y="0.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow5" id="BPMNEdge_flow5">
        <omgdi:waypoint x="330.0" y="350.0"></omgdi:waypoint>
        <omgdi:waypoint x="329.0" y="324.0"></omgdi:waypoint>
        <omgdi:waypoint x="370.0" y="323.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="13.0" width="100.0" x="10.0" y="0.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow6" id="BPMNEdge_flow6">
        <omgdi:waypoint x="330.0" y="390.0"></omgdi:waypoint>
        <omgdi:waypoint x="330.0" y="411.0"></omgdi:waypoint>
        <omgdi:waypoint x="370.0" y="411.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="13.0" width="14.0" x="10.0" y="0.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow7" id="BPMNEdge_flow7">
        <omgdi:waypoint x="475.0" y="411.0"></omgdi:waypoint>
        <omgdi:waypoint x="520.0" y="412.0"></omgdi:waypoint>
        <omgdi:waypoint x="520.0" y="390.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow8" id="BPMNEdge_flow8">
        <omgdi:waypoint x="475.0" y="323.0"></omgdi:waypoint>
        <omgdi:waypoint x="519.0" y="324.0"></omgdi:waypoint>
        <omgdi:waypoint x="520.0" y="350.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow9" id="BPMNEdge_flow9">
        <omgdi:waypoint x="540.0" y="370.0"></omgdi:waypoint>
        <omgdi:waypoint x="570.0" y="370.0"></omgdi:waypoint>
        <omgdi:waypoint x="570.0" y="277.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow12" id="BPMNEdge_flow12">
        <omgdi:waypoint x="1060.0" y="602.0"></omgdi:waypoint>
        <omgdi:waypoint x="1082.0" y="602.0"></omgdi:waypoint>
        <omgdi:waypoint x="1082.0" y="263.0"></omgdi:waypoint>
        <omgdi:waypoint x="1110.0" y="264.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow15" id="BPMNEdge_flow15">
        <omgdi:waypoint x="1480.0" y="602.0"></omgdi:waypoint>
        <omgdi:waypoint x="1502.0" y="603.0"></omgdi:waypoint>
        <omgdi:waypoint x="1502.0" y="288.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow16" id="BPMNEdge_flow16">
        <omgdi:waypoint x="1555.0" y="258.0"></omgdi:waypoint>
        <omgdi:waypoint x="1710.0" y="257.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow18" id="BPMNEdge_flow18">
        <omgdi:waypoint x="1762.0" y="285.0"></omgdi:waypoint>
        <omgdi:waypoint x="1762.0" y="603.0"></omgdi:waypoint>
        <omgdi:waypoint x="1810.0" y="602.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow19" id="BPMNEdge_flow19">
        <omgdi:waypoint x="2020.0" y="602.0"></omgdi:waypoint>
        <omgdi:waypoint x="2053.0" y="602.0"></omgdi:waypoint>
        <omgdi:waypoint x="2052.0" y="285.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow21" id="BPMNEdge_flow21">
        <omgdi:waypoint x="985.0" y="603.0"></omgdi:waypoint>
        <omgdi:waypoint x="1020.0" y="602.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow25" id="BPMNEdge_flow25">
        <omgdi:waypoint x="1915.0" y="602.0"></omgdi:waypoint>
        <omgdi:waypoint x="1980.0" y="602.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow23" id="BPMNEdge_flow23">
        <omgdi:waypoint x="1385.0" y="602.0"></omgdi:waypoint>
        <omgdi:waypoint x="1440.0" y="602.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow35" id="BPMNEdge_flow35">
        <omgdi:waypoint x="2105.0" y="257.0"></omgdi:waypoint>
        <omgdi:waypoint x="2170.0" y="257.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow37" id="BPMNEdge_flow37">
        <omgdi:waypoint x="1215.0" y="264.0"></omgdi:waypoint>
        <omgdi:waypoint x="1248.0" y="263.0"></omgdi:waypoint>
        <omgdi:waypoint x="1248.0" y="602.0"></omgdi:waypoint>
        <omgdi:waypoint x="1280.0" y="602.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow38" id="BPMNEdge_flow38">
        <omgdi:waypoint x="195.0" y="257.0"></omgdi:waypoint>
        <omgdi:waypoint x="250.0" y="257.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow39" id="BPMNEdge_flow39">
        <omgdi:waypoint x="590.0" y="257.0"></omgdi:waypoint>
        <omgdi:waypoint x="640.0" y="258.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow40" id="BPMNEdge_flow40">
        <omgdi:waypoint x="745.0" y="258.0"></omgdi:waypoint>
        <omgdi:waypoint x="799.0" y="257.0"></omgdi:waypoint>
        <omgdi:waypoint x="799.0" y="602.0"></omgdi:waypoint>
        <omgdi:waypoint x="880.0" y="603.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow41" id="BPMNEdge_flow41">
        <omgdi:waypoint x="975.0" y="650.0"></omgdi:waypoint>
        <omgdi:waypoint x="974.0" y="670.0"></omgdi:waypoint>
        <omgdi:waypoint x="1040.0" y="670.0"></omgdi:waypoint>
        <omgdi:waypoint x="1040.0" y="622.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow42" id="BPMNEdge_flow42">
        <omgdi:waypoint x="1375.0" y="650.0"></omgdi:waypoint>
        <omgdi:waypoint x="1374.0" y="666.0"></omgdi:waypoint>
        <omgdi:waypoint x="1460.0" y="666.0"></omgdi:waypoint>
        <omgdi:waypoint x="1460.0" y="622.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow43" id="BPMNEdge_flow43">
        <omgdi:waypoint x="1920.0" y="652.0"></omgdi:waypoint>
        <omgdi:waypoint x="2000.0" y="651.0"></omgdi:waypoint>
        <omgdi:waypoint x="2000.0" y="622.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="association4" id="BPMNEdge_association4">
        <omgdi:waypoint x="932.0" y="568.0"></omgdi:waypoint>
        <omgdi:waypoint x="942.0" y="539.0"></omgdi:waypoint>
        <omgdi:waypoint x="1040.0" y="515.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="association5" id="BPMNEdge_association5">
        <omgdi:waypoint x="1332.0" y="575.0"></omgdi:waypoint>
        <omgdi:waypoint x="1359.0" y="545.0"></omgdi:waypoint>
        <omgdi:waypoint x="1360.0" y="525.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="association6" id="BPMNEdge_association6">
        <omgdi:waypoint x="1862.0" y="560.0"></omgdi:waypoint>
        <omgdi:waypoint x="1912.0" y="533.0"></omgdi:waypoint>
        <omgdi:waypoint x="1914.0" y="525.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>